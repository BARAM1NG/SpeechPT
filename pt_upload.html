<html>
<head>
    <link rel="stylesheet" type="text/css" href="main_page_style.css">
</head>
<body>
    <div class="menu-bar">
        <a href="#home" class="logo">Speech PT</a>
        <div class="menu-items">
            <a href="#news">발표 분석</a>
            <a href="#contact">자료 요약</a>
            <a href="#about">멤버 소개</a>
            <a href="#more">History</a>
        </div>
    </div>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <title>Upload Audio File</title>
    <link rel="stylesheet" href="main_page_style.css">
    <style>
        #audioFile {
            display: none; /* Hide the file input */
        }

    </style>
  </head>
  
<body>    
    <input type="file" id="audioFile" accept=".mp3, .wav" onchange="uploadAudio()">
    <button src="/static/upload_button.png" class="custom_upload_btn" onclick="document.getElementById('audioFile').click();">
      <svg class = 'svg1' xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40" fill="none">
  <mask id="mask0_39_984" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="0" y="0" width="40" height="40">
    <path d="M0.444824 0H39.9999V39.5551H0.444824V0Z" fill="white"/>
  </mask>
  <g mask="url(#mask0_39_984)">
    <path d="M5.38916 19.7842V34.6105H35.0555V19.7773" stroke="#909090" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M27.6388 12.3609L20.2222 4.94434L12.8057 12.3609" stroke="#909090" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M20.2153 26.37V4.94434" stroke="#909090" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
  </g>
  </svg>
    <div id = 'result_font1'>분석할 발표 영상을 업로드 해주세요</div> 
      <div id = 'result_font2'>
        *mp4, mov파일<br>
        *파일당 최대 50MB</div>
  </button>   
  
  <button class= 'delete_svg' style="display: none;" onclick="removeFile()">
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="23" viewBox="0 0 22 23" fill="none">
      <path d="M5.5 6L16.4999 16.9999" stroke="#909090" stroke-width="2" stroke-linecap="round"/>
      <path d="M5.5 17L16.4999 6.00012" stroke="#909090" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>
  <button class = 'newBox2' style="display: none;"  onclick="anal()">
  </button> 
  <div class="circle_container">
      <div id = 'spinner' style="display: none;"></div>
    </div>

  <div class = 'bigbox'>분석결과
     <svg class='svg2'xmlns="http://www.w3.org/2000/svg" width="275" height="2" viewBox="0 0 275 2" fill="none">
  <path d="M0 1L275 0.999976" stroke="#BBBBBB" stroke-width="2"/>
  </svg>
      <svg class = 'svg3' xmlns="http://www.w3.org/2000/svg" width="275" height="2" viewBox="0 0 275 2" fill="none">
  <path d="M0 1L275 1.00002" stroke="#BBBBBB" stroke-width="2"/>
  </svg>
  </div>

 
    
<script>
  let oldOnclick;
      async function uploadAudio() {
        const fileInput = document.getElementById('audioFile');
        const file = fileInput.files[0];

        // Provide feedback that a file has been selected
        const upload_btn = document.querySelector('.custom_upload_btn');
        document.getElementById('result_font1').style.display = 'none';
        document.getElementById('result_font2').style.display = 'none';  // 기존 설명 텍스트를 숨깁니다.
        document.getElementById("mask0_39_984").style.display = 'none';
        document.querySelector('.svg1').style.display = 'none';
        oldOnclick = upload_btn.onclick;
        upload_btn.onclick = null;
        upload_btn.style.border='2px solid #DFDFDF';
        upload_btn.style.background = '#FFF';

        
        function createSvgElement(elementType, attributes) {
          const element = document.createElementNS('http://www.w3.org/2000/svg', elementType);
          for (let key in attributes) {
              element.setAttribute(key, attributes[key]);
          }
          return element;
        }
      
        const svgElement = createSvgElement('svg', {
          'width': '29px',
          'height': '37px',
          'flex-shrink': '0',
          'viewBox': '0 0 30 38',
          'fill': 'none',
          'id': 'mov_svg'}
        );
        
        const paths = [
          { "d" : "M19.9189 0L24.5667 4.64773L29.2144 9.29545H19.9189V0Z", 'fill' :"#92DBFF" },
          {'d' : "M2 0C0.895431 0 0 0.895433 0 2V35.1818C0 36.2864 0.89543 37.1818 2 37.1818H27.2143C28.3189 37.1818 29.2143 36.2864 29.2143 35.1818V9.29545H19.9189V0H2Z"
          , 'fill': '#00A8F4', 'fill-rule': 'evenodd', 'clip-rule': 'evenodd' },
          {'d' : "M21.6737 23.3926L23.3788 18.1978H24.6934L22.5183 24.7471H20.8372L18.6541 18.1978H19.9687L21.6737 23.3926Z",
          'fill' : 'white'},
          {'d':"M15.7252 24.8665C15.2099 24.8665 14.7345 24.7523 14.299 24.5239C13.8634 24.3008 13.5155 23.9768 13.2552 23.5518C13.0003 23.1216 12.8728 22.6143 12.8728 22.03V20.9146C12.8728 20.3356 13.0003 19.831 13.2552 19.4007C13.5155 18.9705 13.8634 18.6438 14.299 18.4207C14.7345 18.1923 15.2099 18.0781 15.7252 18.0781C16.2404 18.0781 16.7158 18.1923 17.1514 18.4207C17.5869 18.6438 17.9322 18.9705 18.1871 19.4007C18.4474 19.831 18.5776 20.3356 18.5776 20.9146V22.03C18.5776 22.6143 18.4474 23.1216 18.1871 23.5518C17.9322 23.9768 17.5869 24.3008 17.1514 24.5239C16.7158 24.7523 16.2404 24.8665 15.7252 24.8665ZM15.7252 23.7032C16.0173 23.7032 16.2856 23.6395 16.5299 23.512C16.7742 23.3792 16.9681 23.1827 17.1115 22.922",},
          {'d' : "M6.18525 24.7471H4.95825V18.1978H6.62347L8.49584 23.1934L10.3682 18.1978H12.0334V24.7471H10.8064V20.2534L9.1173 24.7471H7.87437L6.18525 20.2534V24.7471Z",
          'fill' : 'white'}
          ];
        paths.forEach(path => {
          svgElement.appendChild(createSvgElement('path',path))
        });
        svgElement.id = 'mov_svg';

        const newBox = document.createElement('div');
        newBox.id = 'newBox';
        
        const newBox2 = document.createElement('div');
        newBox2.className = 'newBox2';
        newBox2.onclick = anal;
        newBox2.style.display = 'block';

        function anal() {
          alert('button clicked')
          document.getElementById('spinner').style.display = 'block';
          const analBox = document.querySelector('.custom_upload_btn');
          const analtext = document.createElement('div');
          analtext.id = 'result_font3';
          analtext.innerText = '분석 중...';
          analBox.appendChild(analtext);
          document.getElementsByClassName('delete_svg')[0].style.display = 'none';
          analBox.style.border='2px solid #DFDFDF';
          analBox.style.background = '#FCFCFC';
          analBox.style.position = 'absolute';
          analBox.removeChild(newBox);
          analBox.removeChild(newBox2);
        }

        const fileSizeInMB = file.size/1024/1024;
        
        const fileNameElement = document.createElement('div');
        fileNameElement.id = 'fileNameElementId';
        fileNameElement.innerText = file.name;

        const fileNameElement2 = document.createElement('div');
        fileNameElement2.id = 'fileNameElementId2';
        fileNameElement2.innerText = '분석하기'

        const fileNameElement3 = document.createElement('div');
        fileNameElement3.id = 'fileNameElementId3';
        fileNameElement3.innerText = fileSizeInMB.toFixed(2)+'MB';

        newBox.appendChild(fileNameElement);
        newBox.appendChild(svgElement);
        newBox.appendChild(fileNameElement3);
        newBox2.appendChild(fileNameElement2);
        upload_btn.appendChild(newBox);
        upload_btn.appendChild(newBox2);
        
        document.getElementsByClassName('delete_svg')[0].style.display = 'block';

        const formData = new FormData();
        formData.append('file', file);

        try {
            const response = await fetch('http://127.0.0.1:8000/upload', {
                method: 'POST',
                body: formData
            });
            if (response.ok){
              const data = await response.json();
            }
          } catch (error) {
            console.error('Error:', error);
            alert(error)
          } 
      } 
      async function removeFile() {
        const fileInput = document.getElementById('audioFile');
        fileInput.value = '';
        document.getElementsByClassName('delete_svg')[0].style.display = 'none';
        const uploadButton = document.querySelector('.custom_upload_btn');
        const newBox2 = document.querySelector('.newBox2');
        uploadButton.style.backgroundColor = '';
        uploadButton.style.border = '';
        uploadButton.style.width = '';
        uploadButton.style.height = '';
        uploadButton.onclick = oldOnclick;
        // SVG 아이콘과 텍스트를 다시 보이게 합니다.
        document.querySelector('.svg1').style.display = '';
        document.getElementById('result_font1').style.display = '';
        document.getElementById('result_font2').style.display = '';
        document.getElementById("mask0_39_984").style.display = '';
        document.getElementById('result_font1').innerText = '분석할 발표 영상을 업로드 해주세요';
        
        // 새롭게 추가한 박스를 제거합니다.
        
        uploadButton.removeChild(newBox);
        uploadButton.removeChild(newBox2);
      }
    </script>
    

</body>
</html>